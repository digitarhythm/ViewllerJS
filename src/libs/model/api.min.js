var __jsdir,bodyParser,cwd,database,echo,express,fs,multer,node_env,nodemailer,router,upload;router=(express=require("express")).Router(),bodyParser=require("body-parser"),fs=require("fs-extra"),multer=require("multer"),nodemailer=require("nodemailer"),echo=require("ndlog").echo,database=require("./dbmodel.min"),node_env=process.env.NODE_ENV,__jsdir="develop"===node_env?"develop":"production",upload=multer({dest:`${cwd=fs.realpathSync(process.cwd())}/apps/${__jsdir}/public`}),router.post("/sendmail",function(e,r){var t,o,n,s,u,a;return t=(s=JSON.parser(e.body)).from||"postmaster",a=s.to||void 0,u=s.subject||"no subject",n=s.message||"no message",null==a&&r.json({err:-1}),o={from:t,to:a,subject:u,text:n},nodemailer.createTransport({host:"localhost",port:25,use_authentication:!1,tls:{rejectUnauthorized:!1}}).sendMail(o,function(e,t){return e?(console.log(e),process.exit(1)):(console.log("Message sent: "+t.response),r.json({err:0}))})}),router.post("/copy",function(e,r){return new Promise(function(e,r){return fs.copy(path,function(t){return t?r(t):e(!0)})})}),router.post("/mkdir",function(e,r){return new Promise(function(e,r){return fs.mkdirs(path,function(t){return t?r(t):e(!0)})})}),router.post("/filelist",function(e,r){var t,o;return o=function(e){return new Promise(function(r,t){return fs.readdir(e,function(e,o){return e?t(e):r(o)})})},t=JSON.parse(e.body).path||"",o(`${cwd}/apps/${__jsdir}/public/${t}`).then(function(e){return r.json(e)}).catch(function(e){return console.error(e),process.exit(1)})}),router.post("/file_upload",upload.any(),function(e,r){var t,o,n;n=JSON.parse(e.body),t=""!==n.dir?n.dir+"/":"";try{return o=[],e.files.map(e=>{var r,n;return n=`${e.path}`,r=`${e.destination}/${t}${e.originalname}`,fs.moveSync(n,r,{overwrite:!0}),o.push(r)}),r.json({err:0,files:o})}catch(e){return e,r.json({err:-1})}}),router.post("/file_unlink",function(e,r){var t,o;if(null==(t=JSON.parse(e.body).path))return r.json({file:"",err:-2});o=`${cwd}/apps/${__jsdir}/public/${t}`;try{return fs.removeSync(o),r.json({file:o,err:0})}catch(e){return e,r.json({err:-1})}}),router.post("/upsert",function(e,r,t){var o,n,s;return n=(o=e.body).table||void 0,s=o.values||void 0,database.upsert({table:n,values:s}).then(function(e){return r.json({err:e})}).catch(e=>r.json({err:e}))}),router.post("/select",function(e,r,t){var o,n,s;return n=(o=e.body).table||void 0,s=o.where||void 0,database.select({table:n,where:s}).then(function(e){return r.json({rows:e,err:0})}).catch(e=>r.json({err:e}))}),router.post("/delete",function(e,r,t){var o,n,s;return n=(o=e.body).table||void 0,s=o.where||void 0,database.delete({table:n,where:s}).then(function(e){return r.json({rows:e,err:0})}).catch(e=>r.json({err:e}))}),router.post("/update",function(e,r,t){var o,n,s,u;return n=(o=e.body).table||void 0,s=o.values||void 0,u=o.where||void 0,database.update({table:n,values:s,where:u}).then(function(e){return r.json({err:e})}).catch(e=>r.json({err:e}))}),router.post("/reset_autoincrement",function(e,r,t){var o;return o=e.body.table||void 0,database.reset_autoincrement({table:o}).then(function(e){return r.json({err:e})}).catch(e=>r.json({err:e}))}),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsiX19qc2RpciIsImJvZHlQYXJzZXIiLCJjd2QiLCJkYXRhYmFzZSIsImVjaG8iLCJleHByZXNzIiwiZnMiLCJtdWx0ZXIiLCJub2RlX2VudiIsIm5vZGVtYWlsZXIiLCJyb3V0ZXIiLCJ1cGxvYWQiLCJyZXF1aXJlIiwiUm91dGVyIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiZGVzdCIsInJlYWxwYXRoU3luYyIsInBvc3QiLCJyZXEiLCJyZXMiLCJmcm9tIiwibWFpbE9wdGlvbnMiLCJtZXNzYWdlIiwicGFyYW0iLCJzdWJqZWN0IiwidG8iLCJKU09OIiwicGFyc2VyIiwiYm9keSIsImpzb24iLCJlcnIiLCJ0ZXh0IiwiY3JlYXRlVHJhbnNwb3J0IiwiaG9zdCIsInBvcnQiLCJ1c2VfYXV0aGVudGljYXRpb24iLCJ0bHMiLCJyZWplY3RVbmF1dGhvcml6ZWQiLCJzZW5kTWFpbCIsImVycm9yIiwiaW5mbyIsImNvbnNvbGUiLCJsb2ciLCJleGl0IiwicmVzcG9uc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNvcHkiLCJwYXRoIiwibWtkaXJzIiwiZGlyIiwicmVhZEZpbGVMaXN0IiwicmVhZGRpciIsImxpc3RzIiwicGFyc2UiLCJ0aGVuIiwiZmlsZWxpc3QiLCJjYXRjaCIsImFueSIsImZpbGVzIiwibWFwIiwiZCIsImRzdCIsInNyYyIsImRlc3RpbmF0aW9uIiwib3JpZ2luYWxuYW1lIiwibW92ZVN5bmMiLCJvdmVyd3JpdGUiLCJwdXNoIiwiZXJyb3IxIiwiZmlsZSIsInJlbW92ZVN5bmMiLCJuZXh0IiwidGFibGUiLCJ2YWx1ZXMiLCJ1cHNlcnQiLCJyZXQiLCJ3aGVyZSIsInNlbGVjdCIsInJvd3MiLCJkZWxldGUiLCJ1cGRhdGUiLCJyZXNldF9hdXRvaW5jcmVtZW50IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsUUFBU0MsV0FBWUMsSUFBS0MsU0FBVUMsS0FBTUMs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