var __jsdir,bodyParser,cwd,database,echo,express,fs,multer,node_env,nodemailer,router,upload;router=(express=require("express")).Router(),bodyParser=require("body-parser"),fs=require("fs-extra"),multer=require("multer"),nodemailer=require("nodemailer"),echo=require("ndlog").echo,database=require("./dbmodel.min"),node_env=process.env.NODE_ENV,__jsdir="develop"===node_env?"develop":"production",upload=multer({dest:`${cwd=fs.realpathSync(process.cwd())}/apps/${__jsdir}/public`}),router.post("/sendmail",function(r,e){var o,n,t,s,u,i;return o=(s=JSON.parser(r.body)).from||"postmaster",i=s.to||void 0,u=s.subject||"no subject",t=s.message||"no message",null==i&&e.json({err:-1}),n={from:o,to:i,subject:u,text:t},nodemailer.createTransport({host:"localhost",port:25,use_authentication:!1,tls:{rejectUnauthorized:!1}}).sendMail(n,function(r,o){return r?(console.log(r),process.exit(1)):(console.log("Message sent: "+o.response),e.json({err:0}))})}),router.post("/copy",function(r,e){return new Promise(function(r,e){return fs.copy(path,function(o){return o?e(o):r(!0)})})}),router.post("/mkdir",function(r,e){return new Promise(function(r,e){return fs.mkdirs(path,function(o){return o?e(o):r(!0)})})}),router.post("/filelist",function(r,e){var o,n;return n=function(r){return new Promise(function(e,o){return fs.readdir(r,function(r,n){return r?o(r):e(n)})})},o=JSON.parse(r.body).path||"",n(`${cwd}/apps/${__jsdir}/public/${o}`).then(function(r){return e.json(r)}).catch(function(r){return console.error(r),process.exit(1)})}),router.post("/file_upload",upload.any(),function(r,e){var o,n,t;t=JSON.parse(r.body),o=""!==t.dir?t.dir+"/":"";try{return n=[],r.files.map(r=>{var e,t;return t=`${r.path}`,e=`${r.destination}/${o}${r.originalname}`,fs.moveSync(t,e,{overwrite:!0}),n.push(e)}),e.json({err:0,files:n})}catch(r){return r,e.json({err:-1})}}),router.post("/file_unlink",function(r,e){var o,n;if(null==(o=JSON.parse(r.body).path))return e.json({file:"",err:-2});n=`${cwd}/apps/${__jsdir}/public/${o}`;try{return fs.removeSync(n),e.json({file:n,err:0})}catch(r){return r,e.json({err:-1})}}),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsiX19qc2RpciIsImJvZHlQYXJzZXIiLCJjd2QiLCJkYXRhYmFzZSIsImVjaG8iLCJleHByZXNzIiwiZnMiLCJtdWx0ZXIiLCJub2RlX2VudiIsIm5vZGVtYWlsZXIiLCJyb3V0ZXIiLCJ1cGxvYWQiLCJyZXF1aXJlIiwiUm91dGVyIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiZGVzdCIsInJlYWxwYXRoU3luYyIsInBvc3QiLCJyZXEiLCJyZXMiLCJmcm9tIiwibWFpbE9wdGlvbnMiLCJtZXNzYWdlIiwicGFyYW0iLCJzdWJqZWN0IiwidG8iLCJKU09OIiwicGFyc2VyIiwiYm9keSIsImpzb24iLCJlcnIiLCJ0ZXh0IiwiY3JlYXRlVHJhbnNwb3J0IiwiaG9zdCIsInBvcnQiLCJ1c2VfYXV0aGVudGljYXRpb24iLCJ0bHMiLCJyZWplY3RVbmF1dGhvcml6ZWQiLCJzZW5kTWFpbCIsImVycm9yIiwiaW5mbyIsImNvbnNvbGUiLCJsb2ciLCJleGl0IiwicmVzcG9uc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNvcHkiLCJwYXRoIiwibWtkaXJzIiwiZGlyIiwicmVhZEZpbGVMaXN0IiwicmVhZGRpciIsImxpc3RzIiwicGFyc2UiLCJ0aGVuIiwiZmlsZWxpc3QiLCJjYXRjaCIsImFueSIsImZpbGVzIiwibWFwIiwiZCIsImRzdCIsInNyYyIsImRlc3RpbmF0aW9uIiwib3JpZ2luYWxuYW1lIiwibW92ZVN5bmMiLCJvdmVyd3JpdGUiLCJwdXNoIiwiZXJyb3IxIiwiZmlsZSIsInJlbW92ZVN5bmMiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxRQUFTQyxXQUFZQyxJQUFLQyxTQUFVQyxLQUFNQyxRQUFTQyxHQUFJQyxPQUFRQyxTQUFVQyxXQUFZQyxPQUFRQyxPQUlqR0QsUUFGQUwsUUFBVU8sUUFBUSxZQUVEQyxTQUVqQlosV0FBYVcsUUFBUSxlQUVyQk4sR0FBS00sUUFBUSxZ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